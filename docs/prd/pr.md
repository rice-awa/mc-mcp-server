### 项目需求描述文档 (PRD)

# Minecraft MCP服务器

## 项目概述

Minecraft MCP服务器是一个基于WebSocket的服务，用于连接Minecraft客户端与大语言模型(LLM)API。该项目实现了以下核心功能：

1. 通过WebSocket协议与Minecraft客户端建立实时通信
2. 使用MCP（Model Context Protocol）标准处理LLM的输入输出
3. 提供游戏内聊天、命令执行和脚本事件处理功能
4. 支持LLM思考过程的实时展示

## 核心功能需求

### 1. WebSocket服务器

- 在指定IP和端口上启动WebSocket服务器
- 处理客户端连接、消息接收和发送
- 维护连接状态和会话信息
- 支持多客户端并发连接

### 2. Minecraft客户端通信

- 订阅Minecraft游戏事件（如玩家消息）
- 向游戏内发送聊天消息
- 执行Minecraft命令
- 通过脚本事件发送数据

### 3. LLM集成

- 连接到LLM API（如DeepSeek-R1、GPT-4o等）
- 发送用户提示并接收模型响应
- 支持流式输出，实时显示LLM回复
- 可选显示LLM思考过程

### 4. 安全认证

- 实现基于密钥的登录机制
- 生成和验证会话令牌
- 限制未认证用户的功能访问

### 5. 会话管理

- 支持上下文历史记录的开启/关闭
- 保存和清理对话历史
- 管理连接的唯一标识符(UUID)

## 用户交互流程

1. 用户通过Minecraft客户端连接到WebSocket服务器
2. 服务器发送欢迎消息，包含连接信息
3. 用户通过游戏内聊天输入特定命令（如"#登录"、"GPT 聊天"等）
4. 服务器验证用户权限并处理相应请求
5. 对于LLM请求，服务器将实时返回模型响应到游戏内聊天

## 命令系统

系统支持以下命令：

| 命令 | 功能描述 |
|------|---------|
| #登录 | 使用密钥验证用户身份 |
| GPT 聊天 | 向LLM发送消息并获取回复 |
| GPT 保存 | 保存当前对话历史 |
| GPT 上下文 | 开启/关闭上下文历史记录 |
| 运行命令 | 在Minecraft中执行命令 |
| GPT 脚本 | 执行LLM生成的脚本 |

## 技术规格

### 环境要求

- Python 3.7+
- 依赖库：asyncio, websockets, uuid
- 环境变量：API密钥和URL

### 性能要求

- 支持多用户并发连接
- 低延迟消息处理（<500ms）
- 稳定的长时间运行能力

### 扩展性

- 模块化设计，便于添加新功能
- 支持多种LLM模型切换
- 可配置的系统参数

## 未来扩展计划

1. 添加更多LLM模型支持
2. 实现用户权限分级系统
3. 增强脚本执行功能
4. 添加数据分析和日志记录功能
5. 开发Web管理界面

## 项目时间线

- 阶段1：基础WebSocket服务器和LLM集成（已完成）
- 阶段2：完善命令系统和安全认证（进行中）
- 阶段3：增强功能和用户体验优化
- 阶段4：性能优化和稳定性测试
- 阶段5：文档完善和开源发布

## 验收标准

1. WebSocket服务器能稳定运行并处理多客户端连接
2. 所有命令功能正常工作
3. LLM响应准确且实时显示
4. 安全认证系统有效防止未授权访问
5. 系统在长时间运行中保持稳定